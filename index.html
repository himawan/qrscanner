<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>QR Scanner</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
        <style> 
            input {
              width: 75%;
            }
            </style>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    Find text: <input type="text" id="qr-reader-plan" name="lname" width="90%"><br />
    Scan Result: <div id="qr-reader-results"></div>
    <div id="qr-reader" style="width:100%"></div>
    
</body>
<script src="html5-qrcode.min.js"></script>
<script>

    var strPlan =document.getElementById('qr-reader-plan').value;
    function docReady(fn) {
        // see if DOM is already available
        if (document.readyState === "complete"
            || document.readyState === "interactive") {
            // call on next available tick
            setTimeout(fn, 1);
        } else {
            document.addEventListener("DOMContentLoaded", fn);
        }
    }

    docReady(function () {
        var resultContainer = document.getElementById('qr-reader-results');
        var lastResult, countResults = 0;
        function onScanSuccess(decodedText, decodedResult) {
            if (decodedText !== lastResult) {
                ++countResults;
                lastResult = decodedText;
                
                // Handle on success condition with the decoded message.
                resultContainer.innerHTML = decodedText ;
                
                if (decodedText.search(strPlan)!== -1){
                    playOK();
                    resultContainer.style.color = "black";
                }else{                   
                    playNG();
                    resultContainer.style.color = "red";                  
                    html5QrcodeScanner.stop().then((ignore) => {
                    // QR Code scanning is stopped.
                    }).catch((err) => {
                    // Stop failed, handle it.
                    });
                    html5QrcodeScanner.clear();
                }              
            }
        }

        var html5QrcodeScanner = new Html5QrcodeScanner(
            "qr-reader", { fps: 10, qrbox: 250 });
        html5QrcodeScanner.render(onScanSuccess);
    });

    function playOK() {
        var audio = new Audio('beep.mp3');
        audio.play();
    }

    function playNG() {
        var audio = new Audio('error.mp3');
        audio.play();
    }
    
</script>
</head>
</html>
